CREATE TABLE "Agents" (
    "AgentId" SERIAL NOT NULL,
    "FullName" VARCHAR(120) NOT NULL,
    "Email" VARCHAR(254) NULL,
    "Phone" VARCHAR(40) NULL,
    "DepartmentId" INTEGER NULL,
    "IsActive" BOOLEAN NULL,
    "HiredAt" DATE NULL
);

CREATE TABLE "Attachments" (
    "AttachmentId" BIGSERIAL NOT NULL,
    "TicketId" BIGINT NOT NULL,
    "FileName" VARCHAR(255) NOT NULL,
    "MimeType" VARCHAR(100) NULL,
    "SizeBytes" BIGINT NULL,
    "StoragePath" VARCHAR(400) NOT NULL,
    "UploadedAt" TIMESTAMP NULL
);

CREATE TABLE "AuditLogs" (
    "AuditId" BIGSERIAL NOT NULL,
    "EntityType" VARCHAR(50) NOT NULL,
    "EntityId" BIGINT NOT NULL,
    "Operation" VARCHAR(20) NOT NULL,
    "PerformedBy" VARCHAR(120) NULL,
    "PerformedAt" TIMESTAMP NULL,
    "DetailsJson" VARCHAR NULL
);

CREATE TABLE "Categories" (
    "CategoryId" SERIAL NOT NULL,
    "Name" VARCHAR(100) NOT NULL
);

CREATE TABLE "Companies" (
    "CompanyId" SERIAL NOT NULL,
    "Name" VARCHAR(120) NOT NULL,
    "CNPJ" VARCHAR(32) NULL,
    "Segmento" VARCHAR(60) NULL,
    "CreatedAt" TIMESTAMP NULL
);

CREATE TABLE "Departments" (
    "DepartmentId" SERIAL NOT NULL,
    "Name" VARCHAR(100) NOT NULL
);

CREATE TABLE "Priorities" (
    "PriorityId" SERIAL NOT NULL,
    "Name" VARCHAR(50) NOT NULL,
    "Weight" INTEGER NULL
);

CREATE TABLE "Products" (
    "ProductId" SERIAL NOT NULL,
    "Name" VARCHAR(150) NOT NULL,
    "Code" VARCHAR(50) NULL,
    "Description" VARCHAR(500) NULL,
    "IsActive" BOOLEAN NULL,
    "CreatedAt" TIMESTAMP NULL
);

CREATE TABLE "SLA_Plans" (
    "SLAPlanId" SERIAL NOT NULL,
    "Name" VARCHAR(80) NOT NULL,
    "FirstResponseMins" INTEGER NULL,
    "ResolutionMins" INTEGER NULL
);

CREATE TABLE "Statuses" (
    "StatusId" SERIAL NOT NULL,
    "Name" VARCHAR(60) NOT NULL
);

CREATE TABLE "Subcategories" (
    "SubcategoryId" SERIAL NOT NULL,
    "CategoryId" INTEGER NOT NULL,
    "Name" VARCHAR(100) NOT NULL
);

CREATE TABLE "Tags" (
    "TagId" SERIAL NOT NULL,
    "Name" VARCHAR(60) NOT NULL
);

CREATE TABLE "TicketInteractions" (
    "InteractionId" BIGSERIAL NOT NULL,
    "TicketId" BIGINT NOT NULL,
    "AuthorType" CHAR(1) NOT NULL,
    "AuthorUserId" INTEGER NULL,
    "AuthorAgentId" INTEGER NULL,
    "Message" VARCHAR NOT NULL,
    "IsPublic" BOOLEAN NULL,
    "CreatedAt" TIMESTAMP NULL
);

CREATE TABLE "Tickets" (
    "TicketId" BIGSERIAL NOT NULL,
    "CompanyId" INTEGER NOT NULL,
    "CreatedByUserId" INTEGER NOT NULL,
    "AssignedAgentId" INTEGER NULL,
    "ProductId" INTEGER NULL,
    "CategoryId" INTEGER NOT NULL,
    "SubcategoryId" INTEGER NULL,
    "PriorityId" INTEGER NOT NULL,
    "CurrentStatusId" INTEGER NOT NULL,
    "SLAPlanId" INTEGER NOT NULL,
    "Title" VARCHAR(200) NOT NULL,
    "Description" VARCHAR NULL,
    "Channel" VARCHAR(40) NULL,
    "Device" VARCHAR(60) NULL,
    "CreatedAt" TIMESTAMP NULL,
    "FirstResponseAt" TIMESTAMP NULL,
    "ClosedAt" TIMESTAMP NULL
);

CREATE TABLE "TicketStatusHistory" (
    "HistoryId" BIGSERIAL NOT NULL,
    "TicketId" BIGINT NOT NULL,
    "FromStatusId" INTEGER NULL,
    "ToStatusId" INTEGER NOT NULL,
    "ChangedAt" TIMESTAMP NULL,
    "ChangedByAgentId" INTEGER NULL
);

CREATE TABLE "TicketTags" (
    "TicketId" BIGINT NOT NULL,
    "TagId" INTEGER NOT NULL
);

CREATE TABLE "Users" (
    "UserId" SERIAL NOT NULL,
    "CompanyId" INTEGER NULL,
    "FullName" VARCHAR(120) NOT NULL,
    "Email" VARCHAR(254) NULL,
    "Phone" VARCHAR(40) NULL,
    "CPF" VARCHAR(32) NULL,
    "CreatedAt" TIMESTAMP NULL,
    "IsVIP" BOOLEAN NULL
);

ALTER TABLE "Companies" ADD PRIMARY KEY ("CompanyId");

ALTER TABLE "Departments" ADD PRIMARY KEY ("DepartmentId");

ALTER TABLE "Agents" ADD PRIMARY KEY ("AgentId");

ALTER TABLE "Products" ADD PRIMARY KEY ("ProductId");

ALTER TABLE "Users" ADD PRIMARY KEY ("UserId");

ALTER TABLE "Categories" ADD PRIMARY KEY ("CategoryId");

ALTER TABLE "Subcategories" ADD PRIMARY KEY ("SubcategoryId");

ALTER TABLE "Priorities" ADD PRIMARY KEY ("PriorityId");

ALTER TABLE "Statuses" ADD PRIMARY KEY ("StatusId");

ALTER TABLE "SLA_Plans" ADD PRIMARY KEY ("SLAPlanId");

ALTER TABLE "Tags" ADD PRIMARY KEY ("TagId");

ALTER TABLE "Tickets" ADD PRIMARY KEY ("TicketId");

ALTER TABLE "TicketStatusHistory" ADD PRIMARY KEY ("HistoryId");

ALTER TABLE "TicketInteractions" ADD PRIMARY KEY ("InteractionId");

ALTER TABLE "Attachments" ADD PRIMARY KEY ("AttachmentId");

ALTER TABLE "AuditLogs" ADD PRIMARY KEY ("AuditId");

ALTER TABLE "TicketTags" ADD PRIMARY KEY ("TicketId");

ALTER TABLE "Agents" ADD CONSTRAINT "FK_Agents_Department" FOREIGN KEY ("DepartmentId") REFERENCES "Departments" ("DepartmentId");

ALTER TABLE "Attachments" ADD CONSTRAINT "FK_Att_Ticket" FOREIGN KEY ("TicketId") REFERENCES "Tickets" ("TicketId");

ALTER TABLE "Subcategories" ADD CONSTRAINT "FK_Subcategories_Category" FOREIGN KEY ("CategoryId") REFERENCES "Categories" ("CategoryId");

ALTER TABLE "TicketInteractions" ADD CONSTRAINT "FK_TI_Agent" FOREIGN KEY ("AuthorAgentId") REFERENCES "Agents" ("AgentId");

ALTER TABLE "TicketInteractions" ADD CONSTRAINT "FK_TI_Ticket" FOREIGN KEY ("TicketId") REFERENCES "Tickets" ("TicketId");

ALTER TABLE "TicketInteractions" ADD CONSTRAINT "FK_TI_User" FOREIGN KEY ("AuthorUserId") REFERENCES "Users" ("UserId");

ALTER TABLE "Tickets" ADD CONSTRAINT "FK_Tickets_Agent" FOREIGN KEY ("AssignedAgentId") REFERENCES "Agents" ("AgentId");

ALTER TABLE "Tickets" ADD CONSTRAINT "FK_Tickets_Category" FOREIGN KEY ("CategoryId") REFERENCES "Categories" ("CategoryId");

ALTER TABLE "Tickets" ADD CONSTRAINT "FK_Tickets_Company" FOREIGN KEY ("CompanyId") REFERENCES "Companies" ("CompanyId");

ALTER TABLE "Tickets" ADD CONSTRAINT "FK_Tickets_Priority" FOREIGN KEY ("PriorityId") REFERENCES "Priorities" ("PriorityId");

ALTER TABLE "Tickets" ADD CONSTRAINT "FK_Tickets_Product" FOREIGN KEY ("ProductId") REFERENCES "Products" ("ProductId");

ALTER TABLE "Tickets" ADD CONSTRAINT "FK_Tickets_SLA" FOREIGN KEY ("SLAPlanId") REFERENCES "SLA_Plans" ("SLAPlanId");

ALTER TABLE "Tickets" ADD CONSTRAINT "FK_Tickets_Status" FOREIGN KEY ("CurrentStatusId") REFERENCES "Statuses" ("StatusId");

ALTER TABLE "Tickets" ADD CONSTRAINT "FK_Tickets_Subcategory" FOREIGN KEY ("SubcategoryId") REFERENCES "Subcategories" ("SubcategoryId");

ALTER TABLE "Tickets" ADD CONSTRAINT "FK_Tickets_User" FOREIGN KEY ("CreatedByUserId") REFERENCES "Users" ("UserId");

ALTER TABLE "TicketStatusHistory" ADD CONSTRAINT "FK_TSH_Agent" FOREIGN KEY ("ChangedByAgentId") REFERENCES "Agents" ("AgentId");

ALTER TABLE "TicketStatusHistory" ADD CONSTRAINT "FK_TSH_FromStatus" FOREIGN KEY ("FromStatusId") REFERENCES "Statuses" ("StatusId");

ALTER TABLE "TicketStatusHistory" ADD CONSTRAINT "FK_TSH_Ticket" FOREIGN KEY ("TicketId") REFERENCES "Tickets" ("TicketId");

ALTER TABLE "TicketStatusHistory" ADD CONSTRAINT "FK_TSH_ToStatus" FOREIGN KEY ("ToStatusId") REFERENCES "Statuses" ("StatusId");

ALTER TABLE "TicketTags" ADD CONSTRAINT "FK_TT_Tag" FOREIGN KEY ("TagId") REFERENCES "Tags" ("TagId");

ALTER TABLE "TicketTags" ADD CONSTRAINT "FK_TT_Ticket" FOREIGN KEY ("TicketId") REFERENCES "Tickets" ("TicketId");

ALTER TABLE "Users" ADD CONSTRAINT "FK_Users_Company" FOREIGN KEY ("CompanyId") REFERENCES "Companies" ("CompanyId");